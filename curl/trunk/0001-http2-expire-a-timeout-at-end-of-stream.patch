From 59041f052a5209a3aebb146c01b689424f9f7b04 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Thu, 17 Oct 2019 14:25:45 +0200
Subject: http2: expire a timeout at end of stream

To make sure that transfer is being dealt with. Streams without
Content-Length need a final read to notice the end-of-stream state.

Reported-by: Tom van der Woerdt
Fixes #4496
---
 lib/http2.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/http2.c b/lib/http2.c
index b5b831b56..c0f29f83e 100644
--- a/lib/http2.c
+++ b/lib/http2.c
@@ -848,6 +848,7 @@ static int on_stream_close(nghttp2_session *session, int32_t stream_id,
     stream->closed = TRUE;
     httpc = &conn->proto.httpc;
     drain_this(data_s, httpc);
+    Curl_expire(data_s, 0, EXPIRE_RUN_NOW);
     httpc->error_code = error_code;
 
     /* remove the entry from the hash as the stream is now gone */
